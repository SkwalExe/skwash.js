!function(f){"object"==typeof exports&&"undefined"!=typeof module?module.exports=f():"function"==typeof define&&define.amd?define([],f):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).ShellEmulator=f()}(function(){return function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);throw(f=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",f}c=n[i]={exports:{}},e[i][0].call(c.exports,function(r){return o(e[i][1][r]||r)},c,c.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){void 0!==module&&(module.exports=class{constructor(aamp=!0,gt=!0,ppipe=!0,pipe=!0,ggt=!0,lt=!0,llt=!0){this.tokens=[],aamp&&this.tokens.push("&&"),ppipe&&this.tokens.push("||"),pipe&&this.tokens.push("|"),ggt&&this.tokens.push(">>"),gt&&this.tokens.push(">"),llt&&this.tokens.push("<<"),lt&&this.tokens.push("<"),this.utils=require("./utils"),this.Command=class{constructor(){this.invalid=!1,this.invalidReason=null,this.args=[],this[">"]=[],this["&&"]=null,this["||"]=null,this["|"]=null,this[">>"]=[],this["<"]=[],this["<<"]=[],this.name=null,this.text=null}},this.parseCommands=commands=>{let parsedCommands=[];return commands.forEach(command=>parsedCommands.push(this.parseCommand(command))),parsedCommands},this.parse=commandLine=>{let semicolonIndexes=this.utils.getAllOccurrencesOf(";",commandLine);return semicolonIndexes=semicolonIndexes.filter(index=>!this.utils.isBetweenQuotes(commandLine,index)),this.parseCommands(this.utils.splitAt(semicolonIndexes,commandLine))},this.parseCommand=string=>{string=string.trim();let commandObject=new this.Command,command="",writeTo="command",ignoreNextChar=!1,gtIndex=-1,gtgtIndex=-1,ltIndex=-1,ltltIndex=-1;commandObject.text=string;for(let i=0;i<string.length;i++)if(ignoreNextChar)ignoreNextChar=!1;else{var char=string[i];if(this.tokens.some(token=>string.substring(i).startsWith(token))&&!this.utils.isBetweenQuotes(string,i)){var token=this.tokens.find(token=>string.substring(i).startsWith(token));if(">"===token)writeTo=">",gtIndex++,commandObject[">"][gtIndex]="";else if(">>"===token)ignoreNextChar=!0,writeTo=">>",gtgtIndex++,commandObject[">>"][gtgtIndex]="";else if("<"===token)writeTo="<",ltIndex++,commandObject["<"][ltIndex]="";else if("<<"===token)ignoreNextChar=!0,writeTo="<<",ltltIndex++,commandObject["<<"][ltltIndex]="";else{if("|"===token){commandObject["|"]=this.parseCommand(string.substring(i+1));break}if("&&"===token){commandObject["&&"]=this.parseCommand(string.substring(i+2));break}if("||"===token){commandObject["||"]=this.parseCommand(string.substring(i+2));break}}}else{if("command"===writeTo&&(command+=char),">"===writeTo){if(" "===char&&0<commandObject[">"][gtIndex].length&&!this.utils.isBetweenQuotes(string,i)){writeTo="command";continue}/["']/.test(char)||(commandObject[">"][gtIndex]+=char)}if(">>"===writeTo){if(" "===char&&0<commandObject[">>"][gtgtIndex].length&&!this.utils.isBetweenQuotes(string,i)){writeTo="command";continue}/["']/.test(char)||(commandObject[">>"][gtgtIndex]+=char)}if("<"===writeTo){if(" "===char&&0<commandObject["<"][ltIndex].length&&!this.utils.isBetweenQuotes(string,i)){writeTo="command";continue}/["']/.test(char)||(commandObject["<"][ltIndex]+=char)}"<<"===writeTo&&(" "===char&&0<commandObject["<<"][ltltIndex].length&&!this.utils.isBetweenQuotes(string,i)?writeTo="command":/["']/.test(char)||(commandObject["<<"][ltltIndex]+=char))}}return command=command.split(" "),commandObject.name=command.shift(),commandObject.args=this.parseArgs(command.join(" ")),-1===commandObject.args?(commandObject.invalid=!0,commandObject.invalidReason="Unclosed Quote"):commandObject.args=commandObject.args.filter(x=>0<x.trim().length),commandObject[">"]=commandObject[">"].map(str=>str.trim()).filter(x=>0<x.trim().length),commandObject[">>"]=commandObject[">>"].map(str=>str.trim()).filter(x=>0<x.trim().length),commandObject["<"]=commandObject["<"].map(str=>str.trim()).filter(x=>0<x.trim().length),commandObject["<<"]=commandObject["<<"].map(str=>str.trim()).filter(x=>0<x.trim().length),commandObject},this.parseArgs=str=>{str=str.trim();let args=[],currentArg="",doubleQuote=!1,singleQuote=!1;for(let i=0;i<str.length;i++){var char=str[i];'"'===char?singleQuote||(doubleQuote=!doubleQuote):"'"===char?doubleQuote||(singleQuote=!singleQuote):" "!==char||doubleQuote||singleQuote?currentArg+=char:(args.push(currentArg),currentArg="")}return args.push(currentArg),doubleQuote||singleQuote?-1:args}}})},{"./utils":3}],2:[function(require,module,exports){module.exports=(string,inside)=>{let indexes=[];for(let i=0;i<inside.length;i++)inside.substring(i,i+string.length)===string&&indexes.push(i);return indexes}},{}],3:[function(require,module,exports){require={isBetweenQuotes:require("./isBetweenQuotes"),getAllOccurrencesOf:require("./getAllOccurrencesOf"),splitAt:require("./splitAt")};module.exports=require},{"./getAllOccurrencesOf":2,"./isBetweenQuotes":4,"./splitAt":5}],4:[function(require,module,exports){module.exports=(str,index)=>{let singleQuote=!1,doubleQuote=!1,singleClosed=!0,doubleClosed=!0,indexPassed=!1;for(let i=0;i<str.length;i++){var char=str[i];if('"'===char){if(singleQuote)continue;doubleClosed=!doubleClosed,indexPassed||(doubleQuote=!doubleQuote)}if("'"===char){if(doubleQuote)continue;singleClosed=!singleClosed,indexPassed||(singleQuote=!singleQuote)}if((indexPassed=i===index?!0:indexPassed)&&doubleClosed&&doubleQuote||singleClosed&&singleQuote)return!0}return!1}},{}],5:[function(require,module,exports){module.exports=(indexes,string)=>{let result=[],currentPartIndex=0;return indexes.forEach(index=>{result.push(string.substring(currentPartIndex,index)),currentPartIndex=index+1}),result.push(string.substring(currentPartIndex)),result}},{}],6:[function(require,module,exports){void 0!==module&&(module.exports=class{constructor(){this.Errors={NOT_FOUND:"No such file or directory",NOT_A_REGULAR_FILE:"Not a regular file",NOT_A_DIRECTORY:"Not a directory",FILE_ALREADY_EXISTS:"File or directory already exists",SAME_FILE:"Source and destination are the same",INVALID_NAME:'Invalid file name, must ba at least one character long and cannot contain \\ / : * ? " < > |',ROOT_PROHIBITED:"You cannot perform this operation on the root directory",NO_FILENAME:"Missing file or directory name"},this.Result=class{constructor(){this.success=!1,this.error=null,this.result=null,this.errorCause=null}},this.tree=[{type:"directory",name:"/",modified:Date.now(),parent:"/",content:[]}],this.currentDirectory="/",this.getPath=function(path){const result=new this.Result;if("/"===(path=this.simplifyPath(path)))return result.success=!0,result.result=this.tree[0],result;path.startsWith("/")&&(path=path.substring(1));let currentDirectory=this.tree[0];var pathArr=path.split("/");for(let i=0;i<pathArr.length;i++){const file=pathArr[i];if("file"===currentDirectory.type)return result.error=this.Errors.NOT_A_DIRECTORY,result.errorCause=currentDirectory.name,result;if(i===pathArr.length-1)return currentDirectory.content.find(f=>f.name===file)?(result.result=currentDirectory.content.find(f=>f.name===file),result.success=!0):(result.error=this.Errors.NOT_FOUND,result.errorCause=file),result;if(void 0===(currentDirectory=currentDirectory.content.find(e=>e.name===file)))return result.error=this.Errors.NOT_FOUND,result.errorCause=file,result}},this.fileExists=function(path){return this.getPath(path).success},this.isRegularFile=function(path){path=this.getPath(path);return!!path.success&&"file"===path.result.type},this.isDir=function(path){path=this.getPath(path);return!!path.success&&"directory"===path.result.type},this.getFileContent=function(path){const result=new this.Result;return this.isRegularFile(path)?(result.success=!0,result.result=this.getPath(path).result.content):(this.isDir(path)?result.error=this.Errors.NOT_A_REGULAR_FILE:result.error=this.Errors.NOT_FOUND,result.errorCause=path),result},this.getDirContent=function(path){const result=new this.Result;return this.isDir(path)?(result.success=!0,result.result=this.getPath(path).result.content):(this.isRegularFile(path)?result.error=this.Errors.NOT_A_DIRECTORY:result.error=this.Errors.NOT_FOUND,result.errorCause=path),result},this.writeFile=function(path,content,append=!1){let result=new this.Result;if(this.fileExists(path)){if(this.isRegularFile(path)){const file=this.getPath(path).result;return append?file.content+=content:file.content=content,result.success=!0,result.result=file,result}return result.error=this.Errors.NOT_A_REGULAR_FILE,result.errorCause=path,result}return result=this.createFile(this.getParentPath(path),this.basename(path),content)},this.createFile=function(path,filename,content=""){const result=new this.Result;if(!filename)return result.error=this.Errors.NO_FILENAME,result;if(path=this.simplifyPath(path),!this.isValidName(filename))return result.error=this.Errors.INVALID_NAME,result.errorCause=filename,result;if(this.fileExists(path+"/"+filename))return result.error=this.Errors.FILE_ALREADY_EXISTS,result.errorCause=this.simplifyPath(path+"/"+filename),result;filename={type:"file",name:filename,modified:Date.now(),parent:path,content:content};if(!this.fileExists(path))return result.error=this.Errors.NOT_FOUND,result.errorCause=path,result;if(!this.isDir(path))return result.error=this.Errors.NOT_A_DIRECTORY,result.errorCause=path,result;const parent=this.getPath(path).result;return parent.content.push(filename),result.success=!0,result.result=filename,result},this.createDir=function(path,dirname){const result=new this.Result;if(!dirname)return result.error=this.Errors.NO_FILENAME,result;if(path=this.simplifyPath(path),!this.isValidName(dirname))return result.error=this.Errors.INVALID_NAME,result.errorCause=dirname,result;if(this.fileExists(path+"/"+dirname))return result.error=this.Errors.FILE_ALREADY_EXISTS,result.errorCause=this.simplifyPath(path+"/"+dirname),result;dirname={type:"directory",name:dirname,modified:Date.now(),parent:path,content:[]};if(!this.fileExists(path))return result.error=this.Errors.NOT_FOUND,result.errorCause=path,result;if(!this.isDir(path))return result.error=this.Errors.NOT_A_DIRECTORY,result.errorCause=path,result;const parent=this.getPath(path).result;return parent.content.push(dirname),result.success=!0,result.result=dirname,result},this.simplifyPath=function(path){if(""===(path=path.trim()))return this.currentDirectory;for(;-1!==path.indexOf("//");)path=path.replace(/\/\//g,"/");if("/"===path)return"/";var parent;if((path=(path=path.endsWith("/")?path.substring(0,path.length-1):path).startsWith("./")?this.simplifyPath(this.currentDirectory+"/"+path.substring(2)):path).startsWith("../")&&(parent=this.getPath(this.currentDirectory).result,path=this.simplifyPath(parent.parent+path.substring(2))),!path.startsWith("/"))return this.simplifyPath(this.currentDirectory+"/"+path);let pathArr=path.split("/");pathArr=pathArr.filter(e=>""!==e);const result=[];for(let i=0;i<pathArr.length;i++){var file=pathArr[i];"."!==file&&(".."===file?0<result.length&&result.pop():result.push(file))}return"/"+result.join("/")},this.delete=function(path){const result=new this.Result;if("/"===path)return result.error=this.Errors.ROOT_PROHIBITED,result.errorCause=path,result;if(!this.fileExists(path))return result.error=this.Errors.NOT_FOUND,result.errorCause=path,result;const file=this.getPath(path).result,parent=this.getPath(file.parent).result;return parent.content=parent.content.filter(e=>e!==file),result.success=!0,result.result=file,result},this.getParent=function(path){const result=new this.Result;return path=this.simplifyPath(path),path=this.getParentPath(path),this.fileExists(path=""===path?"/":path)?this.isDir(path)?(result.result=this.getPath(path).result,result.success=!0):(result.error=this.Errors.NOT_A_DIRECTORY,result.errorCause=path):(result.error=this.Errors.NOT_FOUND,result.errorCause=path),result},this.basename=function(path){return"/"===(path=this.simplifyPath(path))?"/":path.substring(path.lastIndexOf("/")+1)},this.getParentPath=function(path){return"/"===(path=this.simplifyPath(path))?"/":path.substring(0,path.lastIndexOf("/"))},this.getFullPath=function(file){return this.simplifyPath(file.parent+"/"+file.name)},this.isSameFile=function(path1,path2){return(path1=this.simplifyPath(path1))===(path2=this.simplifyPath(path2))},this.isValidName=function(name){return!(0<!(name=name.trim()).length)&&("."!==name&&".."!==name&&!/[\\/:*?"<>|']/.test(name))},this.copy=function(source,destination){const result=new this.Result;if("/"===this.simplifyPath(source))return result.error=this.Errors.ROOT_PROHIBITED,result.errorCause=source,result;if(!this.fileExists(source))return result.error=this.Errors.NOT_FOUND,result.errorCause=source,result;if(this.isSameFile(source,destination))return result.error=this.Errors.SAME_FILE,result.errorCause=source,result;source=this.getPath(source).result;if(this.fileExists(destination)){if(!this.isDir(destination))return result.error=this.Errors.NOT_A_DIRECTORY,result.errorCause=destination,result;if(this.fileExists(destination+"/"+source.name))return result.error=this.Errors.FILE_ALREADY_EXISTS,result.errorCause=destination+"/"+source.name,result;destination=this.getPath(destination).result;const newFile={name:source.name,type:source.type,content:source.content,parent:destination.parent+"/"+destination.name,modified:Date.now()};return destination.content.push(newFile),result.success=!0,result.result=newFile,result}{if(!this.getParent(destination).success)return result.error=this.Errors.NOT_FOUND,result.errorCause=this.getParentPath(destination),result;if(!this.isDir(this.getParentPath(destination)))return result.error=this.Errors.NOT_A_DIRECTORY,result.errorCause=this.getParentPath(destination),result;const destinationParent=this.getParent(destination).result;destination={name:this.basename(destination),type:source.type,content:source.content,modified:Date.now(),parent:this.getFullPath(destinationParent)};return destinationParent.content.push(destination),result.success=!0,result.result=destination,result}},this.move=function(source,destination){const result=new this.Result;source=this.simplifyPath(source),destination=this.simplifyPath(destination);destination=this.copy(source,destination);return destination.success?(this.delete(source),result.success=!0,result.result=destination.result):(result.error=destination.error,result.errorCause=destination.errorCause),result},this.changeDir=function(path){const result=new this.Result;return path=this.simplifyPath(path),this.fileExists(path)?this.isDir(path)?(this.currentDirectory=path,result.success=!0,result.result=path):(result.error=this.Errors.NOT_A_DIRECTORY,result.errorCause=path):(result.error=this.Errors.NOT_FOUND,result.errorCause=path),result},this.CWD=()=>this.simplifyPath(this.currentDirectory),this.toJSON=()=>JSON.stringify(this.tree),this.loadFromJSON=json=>{const result=new this.Result;return this.tree=JSON.parse(json),result.success=!0,result.result=this.tree,result}}})},{}],7:[function(require,module,exports){module.exports=class{constructor(name,description){this.name=name,this.description=description,this.args=[],this.author="@SkwalExe",this.additionalInfo=[],this.argsAfterName=!0,this.longestArgLength=0,this.arg=(flags,description)=>(this.args.push({flags:flags="string"==typeof flags?[flags]:flags,description:description}),flags.join(", ").length>this.longestArgLength&&(this.longestArgLength=flags.join(", ").length),this),this.setAuthor=author=>(this.author=author,this),this.info=info=>(this.additionalInfo.push(info),this),this.showArgsAfterName=argsAfterName=>(this.argsAfterName=argsAfterName,this),this.alignArgs_=!0,this.alignArgs=alignArgs=>(this.alignArgs_=alignArgs,this)}toString=()=>{let result=this.name;return this.argsAfterName&&(result+=0<this.args.length?" "+this.args.reduce((acc,arg)=>acc+=arg.flags.join(", ")+" ",""):""),result=(result=(result=(result=(result=(result=(result+="\n-----------------\n")+this.description+"\nAuthor : ")+this.author)+"\n-----------------\n"+"Options :\n")+this.args.reduce((acc,arg)=>acc+="  "+arg.flags.join(", ")+(this.alignArgs_?" ".repeat(this.longestArgLength-arg.flags.join(", ").length):"")+" : "+arg.description+"\n",""))+(0<this.additionalInfo.length?"\n-----------------\n":""))+this.additionalInfo.join("\n")}}},{}],8:[function(require,module,exports){module.exports=class{success=!1;result=null;error=null;errorCause=null}},{}],9:[function(require,module,exports){module.exports=(env,args)=>{return 2!==args.length?(env.eprint("Please use the following syntax: <alias> <command>"),1):(command=args[1],args=args[0],void 0!==env.commands[args]?(env.eprint("A command/alias with this name already exists : "+args),1):void(env.commands[args]=env.commands[command]));var command}},{}],10:[function(require,module,exports){module.exports=(env,args)=>{args=args[0];if(!args)return env.eprint("basename: missing operand"),1;env.print(env.fs.basename(args))}},{}],11:[function(require,module,exports){module.exports=(env,args)=>{const filesToCat=[];let command="cat";for(;0<args.length;)if("-h"===args[0])command="help",args.shift();else{if(!env.fs.isRegularFile(args[0]))return env.eprint("Not a file or doesn't exists: "+args[0]),1;filesToCat.push(args.shift())}switch(command){case"cat":{if(0===filesToCat.length)return env.eprint("Missing file operand"),1;let textResult="";filesToCat.forEach(file=>{1<filesToCat.length&&(textResult+="\n\n"+env.fs.simplifyPath(file)+" : \n\n"),textResult+=env.fs.getFileContent(file).result}),env.print(textResult.trim());break}case"help":env.print(new env.Help("cat","prints the content of a file").arg("file","The file[s] to print").arg(["-h","--help"],"Prints this help").toString())}}},{}],12:[function(require,module,exports){module.exports=(env,args)=>{args=args[0];return env.fs.fileExists(args)?env.fs.isDir(args)?void env.fs.changeDir(args):(env.eprint("Not a directory : "+args),1):(env.eprint("Directory does not exist : "+args),1)}},{}],13:[function(require,module,exports){module.exports=(env,args)=>{let command="cp",source=null,destination=null;for(;0<args.length;)if("-h"===args[0])command="help",args.shift();else if(null===source)source=args.shift();else{if(null!==destination)return env.eprint("Unknown argument : "+args[0]),1;destination=args.shift()}switch(command){case"help":env.print(new env.Help("cp","Copy files from one location to another",!1).arg(["--help","-h"],"Display this help").arg("source","The source of the copy").arg("destination","The destination of the copy").arg(["--help","-h"],"Display this help").toString());break;case"cp":if(null===source)return env.eprint("Missing required argument : source path"),1;if(null===destination)return env.eprint("Missing required argument : destination path"),1;var operation=env.fs.copy(source,destination);return operation.success?0:(env.eprint(operation.error+" : "+operation.errorCause),1)}}},{}],14:[function(require,module,exports){module.exports=(env,args)=>{let string=args.join(" ");string=(string=(string=(string=(string=(string=string.replace(/\\n/g,"\n")).replace(/\\t/g,"\t")).replace(/\\r/g,"\r")).replace(/\\"/g,'"')).replace(/\\'/g,"'")).replace(/\\\\/g,"\\"),env.print(string)}},{}],15:[function(require,module,exports){module.exports=()=>1},{}],16:[function(require,module,exports){module.exports=(env,args)=>{args.forEach(file=>{env.fs.fileExists(file)||env.print(file+" : No such file or directory"),env.fs.isDir(file)&&env.print(file+" : Directory"),env.fs.isRegularFile(file)&&env.print(file+" : Regular file")})}},{}],17:[function(require,module,exports){module.exports=env=>{const help=new env.Help("skwash.js","linux shell emulator for javascript").arg("help","Display this help").arg("touch","Create a new empty file").arg("ls","List files in the current directory or the specified one").arg("rm","Remove the specified file/directory").arg("cd","Change the current working directory").arg("pwd","Print the current working directory").arg("mkdir","Create a new directory").arg("cat","Display the contents of a file").arg("echo","Echo the specified string").arg("history","Display the history of commands").arg("cp","Copy a file").arg("mv","Move a file").arg("alias","Create an alias for a command").arg("file","Display information about a file").arg("true","Do nothing, successfully").arg("false","Do nothing, unsuccessfully").arg("basename","Get the basename of a file").arg("realpath","Get the absolute path of a file").arg("uname","Display information about the current system").arg("[command]","Run the specified command").showArgsAfterName(!1);env.print(help.toString())}},{}],18:[function(require,module,exports){module.exports=env=>{env.print(env.history.reverse().join("\n"))}},{}],19:[function(require,module,exports){require={touch:require("./touch"),ls:require("./ls"),rm:require("./rm"),cd:require("./cd"),pwd:require("./pwd"),mkdir:require("./mkdir"),cat:require("./cat"),echo:require("./echo"),history:require("./history"),help:require("./help"),cp:require("./cp"),mv:require("./mv"),alias:require("./alias"),file:require("./file"),true:require("./true"),false:require("./false"),basename:require("./basename"),realpath:require("./realpath"),uname:require("./uname")};module.exports=require},{"./alias":9,"./basename":10,"./cat":11,"./cd":12,"./cp":13,"./echo":14,"./false":15,"./file":16,"./help":17,"./history":18,"./ls":20,"./mkdir":21,"./mv":22,"./pwd":23,"./realpath":24,"./rm":25,"./touch":26,"./true":27,"./uname":28}],20:[function(require,module,exports){module.exports=(env,args)=>{const dirsToList=[];let command="ls";const options=[];for(;0<args.length;)switch(args[0]){case"-h":command="help",args.shift();break;case"-a":options.push("a"),args.shift();break;case"-r":options.push("r"),args.shift();break;default:if(!env.fs.fileExists(args[0]))return env.eprint("Unknown argument / no file found : "+args[0]),1;dirsToList.push(args.shift())}switch(command){case"ls":{0===dirsToList.length&&dirsToList.push(".");let textResult="";const recursive=options.includes("r");if(recursive){const lookInside=dir=>{const result=[],files=env.fs.getDirContent(dir).result;return files.forEach(file=>{file=env.fs.getFullPath(file);env.fs.isDir(file)&&(result.push(file),lookInside(file).forEach(subDir=>result.push(subDir)))}),result};dirsToList.forEach(dir=>lookInside(dir).forEach(subDir=>dirsToList.push(subDir)))}dirsToList.forEach(dirToList=>{(recursive||1<dirsToList.length)&&(textResult+="\n"+env.fs.simplifyPath(dirToList)+" : \n");let content=env.fs.getDirContent(dirToList).result;options.includes("a")||(content=content.filter(file=>!file.name.startsWith("."))),textResult+=content.reduce((acc,file)=>acc+=file.name+" ","")+"\n"}),env.print(textResult.trim());break}case"help":env.print(new env.Help("ls","List files in a directory").arg("[dir]","List files in the specified directory").arg(["--all","-a"],"List hidden files").arg(["-r","--recursive"],"Recursively list files in subdirectories").arg(["-h","--help"],"Prints this help").toString())}}},{}],21:[function(require,module,exports){const mkdir=(env,args)=>{const dirsToCreate=[],createdDirs=[],options=[];for(;0<args.length;)"-p"===args[0]?(options.push("p"),args.shift()):dirsToCreate.push(args.shift());if("mkdir",0===dirsToCreate.length)return env.eprint("Missing file operand"),1;for(let i=0;i<dirsToCreate.length;i++){var dir=dirsToCreate[i];if(env.fs.fileExists(dir)){if(options.includes("p"))continue;return env.eprint("File already exists : "+dir),createdDirs.forEach(dir=>env.fs.delete(dir)),1}var parentPath=env.fs.getParentPath(dir),parent=env.fs.getPath(parentPath),dir=env.fs.basename(dir);if(!env.fs.fileExists(parentPath)){if(!options.includes("p"))return env.eprint("Parent directory does not exist : "+parentPath),1;mkdir(env,[parentPath])}if(!env.fs.isDir(parentPath))return env.eprint("Cannot create directory : "+parent+" is not a directory"),1;parent=env.fs.createDir(parentPath,dir);if(!parent.success)return env.print(parent.error+" : "+parent.errorCause),createdDirs.forEach(dir=>env.fs.delete(env.fs.getFullPath(dir))),1;createdDirs.push(parent.result)}};module.exports=mkdir},{}],22:[function(require,module,exports){module.exports=(env,args)=>{const options=[];let command="mv",source=null,destination=null;for(;0<args.length;)switch(args[0]){case"-h":command="help",args.shift();break;case"-f":options.push("f"),args.shift();break;default:null===source?source=args.shift():null===destination?destination=args.shift():env.eprint("Unknown argument : "+args[0])}switch(command){case"help":env.print(new env.Help("mv","Move a file from one location to another",!1).arg(["--force","-f"],"Overwrite existing files").arg(["--help","-h"],"Display this help").arg("source","The source of the move").arg("destination","The destination of the move").toString());break;case"mv":if(null===source)return env.eprint("Missing required argument : source"),1;if(null===destination)return env.eprint("Missing required argument : destination"),1;var operation=env.fs.move(source,destination);return operation.success?0:(env.eprint(operation.error+" : "+operation.errorCause),1)}}},{}],23:[function(require,module,exports){module.exports=env=>{env.print(env.fs.currentDirectory)}},{}],24:[function(require,module,exports){module.exports=(env,args)=>{args.forEach(path=>{env.print(env.fs.simplifyPath(path))}),0===args.length&&env.eprint("Missing operand")}},{}],25:[function(require,module,exports){module.exports=(env,args)=>{const filesToDelete=[];let containsDir=!1;const options=[];let command="rm";for(;0<args.length;)switch(args[0]){case"-r":options.push("r"),args.shift();break;case"-h":command="help",args.shift();break;default:env.fs.isDir(args[0])&&(containsDir=!0),filesToDelete.push(args.shift())}switch(command){case"rm":if(0===filesToDelete.length)return env.eprint("Missing file operand"),1;if(containsDir&&!options.includes("r"))return env.eprint("Cannot remove directory : -r not specified"),1;filesToDelete.forEach(file=>env.fs.delete(file));break;case"help":env.print(new env.Help("rm","Remove files from the file system").arg(["-r","--recursive"],"Remove directories, too").arg("files","Files to remove").info("To delete files starting with - use rm ./-file").toString())}}},{}],26:[function(require,module,exports){module.exports=(env,args)=>{const filesToCreate=[],createdFiles=[];for(;0<args.length;){if(args[0],env.fs.fileExists(args[0]))return env.eprint("File already exists : "+args[0]),1;filesToCreate.push(args.shift())}if(0===filesToCreate.length)return env.eprint("Missing file operand"),1;filesToCreate.forEach(file=>{var parentPath=env.fs.getParentPath(file),file=env.fs.basename(file),parentPath=env.fs.createFile(parentPath,file);if(!parentPath.success)return env.print(parentPath.error+" : "+parentPath.errorCause),createdFiles.forEach(file=>env.fs.delete(env.fs.getFullPath(file))),1;createdFiles.push(parentPath.result)})}},{}],27:[function(require,module,exports){module.exports=()=>0},{}],28:[function(require,module,exports){module.exports=env=>{env.print("Skwash.js - A lightweight javascript driven bash-like shell")}},{}],29:[function(require,module,exports){const FFS=require("fakefilesystem"),CmdLineParser=require("cmdline-parser");void 0!==module&&(module.exports=class{constructor(defaultCommands=!0){this.parser=new CmdLineParser(!0,!0,!0,!1,!0,!1,!1),this.Help=require("./classes/Help"),this.history=[],this.commands=defaultCommands?require("./commands"):{},this.fs=new FFS,this.Result=require("./classes/Result"),this.lastExitCode=0,this.variables={},this.registerCommand=(name,func)=>{const result=new this.Result;return this.commands[name]?(result.error="Command already exists",result.errorCause=name):(this.commands[name]=result.result=func,result.success=!0),result},this.removeCommand=name=>{const result=new this.Result;return this.commands[name]?(delete this.commands[name],result.success=!0):(result.error="Command does not exist",result.errorCause=name),result},this.print=console.log,this.eprint=console.log,this.on=(eventName,func)=>{switch(eventName){case"output":this.print=this.eprint=func;break;case"stdout":this.print=func;break;case"stderr":this.eprint=func}},this.executeCommand=command=>{this.variables.cd=this.fs.CWD(),this.variables["?"]=this.lastExitCode.toString(),this.variables.RANDOM=Math.floor(32767*Math.random()).toString();var variableMatch=(command=command.trim()).match(/^([a-zA-Z0-9_]+)=(.*)$/);if(variableMatch)return name=variableMatch[1],variableMatch=variableMatch[2],this.variables[name]=variableMatch,0;const variables=command.match(/\$([a-zA-Z0-9_]{1,}|\?)/g);if(variables)for(let i=0;i<variables.length;i++){var variable=variables[i].substring(1);command=command.replace("$"+variable,this.variables[variable]||"")}var name=this.parser.parseCommand(command);if(name.invalid)return this.eprint("[ Skwash ] : "+name.invalidReason),130;variableMatch=name.args;let writeTo=name[">"],appendTo=name[">>"];var ifFail=name["||"],ifSuccess=name["&&"],name=name.name,oldPrint=this.print,oldEprint=this.eprint;if((0<writeTo.length||0<appendTo.length)&&(this.print=this.eprint=text=>{for(let i=0;i<writeTo.length;i++)this.fs.writeFile(writeTo[i],text);for(let i=0;i<appendTo.length;i++)this.fs.writeFile(appendTo[i],text,!0)}),!this.commands[name]){if(!this.fs.isRegularFile(name))return this.eprint("[ Skwash ] : Command not found: "+name),this.lastExitCode=127;var file=this.fs.getFileContent(name);if(file.success)return command=file.result,this.run(command)}file=this.commands[name](this,variableMatch);return this.lastExitCode="number"==typeof file?file:0,(0<writeTo.length||0<appendTo.length)&&(this.print=oldPrint,this.eprint=oldEprint),null!==ifFail&&0!==this.lastExitCode&&this.run(ifFail.text),null!==ifSuccess&&0===this.lastExitCode&&this.run(ifSuccess.text),this.lastExitCode},this.run=command=>{if(0<(command=command.trim()).length&&this.history[0]!==command&&"history"!==command&&this.history.unshift(command),/[;\n]/.test(command)){const commands=command.split(/[;\n]/).filter(cmd=>0<cmd.trim().length);if(0<commands.length)return commands.forEach(cmd=>this.executeCommand(cmd)),this.lastExitCode}return command=command.split(/[\s;\n]/).filter(cmd=>0<cmd.trim().length).join(" "),this.executeCommand(command)},this.toJson=()=>JSON.stringify({history:this.history,variables:this.variables,fs:this.fs.tree}),this.loadFromJson=json=>{json=JSON.parse(json);this.history=json.history,this.variables=json.variables,this.fs.tree=json.fs}}})},{"./classes/Help":7,"./classes/Result":8,"./commands":19,"cmdline-parser":1,fakefilesystem:6}]},{},[29])(29)});
